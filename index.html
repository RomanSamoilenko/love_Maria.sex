<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>üíüüíù</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            background-image: radial-gradient(circle at center, #2a000a 0%, #000000 90%);
            font-family: 'Montserrat', sans-serif;
            color: white;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
            transition: background-image 3s ease;
        }

        body.tunnel-active {
            background-image: radial-gradient(circle at center, #5e1b2e 0%, #1a0508 100%);
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .ui-container {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 15vh 0 10vh 0;
            z-index: 10;
            pointer-events: none;
        }

        h1 {
            font-size: clamp(2rem, 7vw, 3.5rem);
            color: #ff3d68;
            text-shadow: 0 0 25px rgba(255, 61, 104, 0.8);
            margin: 0;
            text-align: center;
            pointer-events: auto;
            opacity: 1;
            padding: 0 20px;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            pointer-events: auto;
            width: 80%;
            max-width: 300px;
        }

        .btn {
            padding: 20px 0;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.1s;
            width: 100%;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        #yesBtn {
            background: linear-gradient(45deg, #ff2a55, #ff7b9c);
            color: white;
            box-shadow: 0 0 20px rgba(255, 42, 85, 0.4);
        }

        #yesBtn:active {
            transform: scale(0.95);
        }

        #noBtn {
            background: rgba(255, 255, 255, 0.1);
            color: #ff7b9c;
            border: 1px solid rgba(255, 123, 156, 0.3);
            backdrop-filter: blur(5px);
        }

        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            transition: opacity 1s;
            pointer-events: none;
        }

        .success-overlay.visible {
            opacity: 1;
        }

        .success-overlay h2 {
            font-size: 3rem;
            color: #ff3d68;
            text-shadow: 0 0 20px rgba(255, 61, 104, 0.8);
            margin-bottom: 10px;
        }

        .success-overlay p {
            font-size: 1.2rem;
            color: #fff;
        }
    </style>
</head>

<body>

    <div class="ui-container" id="ui">
        <h1>–ú—ã –ª—É—á—à–∞—è –ø–∞—Ä–∞?</h1>
        <div class="buttons">
            <button class="btn" id="yesBtn">–î–∞! üíù</button>
            <button class="btn" id="noBtn">–ù–µ—Ç</button>
        </div>
    </div>

    <div class="success-overlay" id="successScreen">
        <h2>üíü</h2>
        <p>–Ø –ª—é–±–ª—é —Ç–µ–±—è!</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        const isMobile = window.innerWidth < 768;

        // --- 1. –°–¶–ï–ù–ê ---
        const scene = new THREE.Scene();

        // –í–ê–ñ–ù–û: –î–µ–ª–∞–µ–º —Ç—É–º–∞–Ω –æ—á–µ–Ω—å —Å–ª–∞–±—ã–º –≤ –Ω–∞—á–∞–ª–µ, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–µ–º–Ω—è–ª —Å–µ—Ä–¥—Ü–µ
        // FogExp2(color, density). –ú–µ–Ω—å—à–µ density = –º–µ–Ω—å—à–µ —Ç—É–º–∞–Ω–∞.
        // –ë—ã–ª–æ 0.012, —Å—Ç–∞–≤–∏–º 0.002 (–ø–æ—á—Ç–∏ –Ω–µ—Ç —Ç—É–º–∞–Ω–∞)
        const fogColor = new THREE.Color(0x050102);
        scene.fog = new THREE.FogExp2(fogColor, 0.002);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
        camera.position.z = isMobile ? 60 : 40;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        // Tone mapping –¥–µ–ª–∞–µ–º –±–æ–ª–µ–µ "—Å—ã—Ä—ã–º", —á—Ç–æ–±—ã —Ü–≤–µ—Ç–∞ –±—ã–ª–∏ —è—Ä–∫–∏–º–∏
        renderer.toneMapping = THREE.NoToneMapping;
        document.body.appendChild(renderer.domElement);

        // --- 2. –¢–ï–ö–°–¢–£–†–´ ---
        function createEmojiTexture(emoji) {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.font = '90px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–ª—É—é –æ–±–≤–æ–¥–∫—É –¥–ª—è —è—Ä–∫–æ—Å—Ç–∏ –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ
            ctx.shadowColor = "rgba(255, 255, 255, 0.2)";
            ctx.shadowBlur = 10;
            ctx.fillText(emoji, 64, 64);
            return new THREE.CanvasTexture(canvas);
        }

        const textures = [
            createEmojiTexture('üíü'),
            createEmojiTexture('üíù')
        ];

        // --- 3. –°–ï–†–î–¶–ï ---
        const heartGroup = new THREE.Group();
        scene.add(heartGroup);

        const particles = [];
        const particleCount = isMobile ? 400 : 700;

        for (let i = 0; i < particleCount; i++) {
            const t = Math.random() * Math.PI * 2;
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            const z = (Math.random() - 0.5) * 10;
            const u = Math.random();
            const scaleFactor = Math.sqrt(u);

            const material = new THREE.SpriteMaterial({
                map: textures[i % 2],
                transparent: true,
                opacity: 1.0, // –ü–æ–ª–Ω–∞—è –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
                color: 0xffffff, // –ß–∏—Å—Ç—ã–π –±–µ–ª—ã–π —Ü–≤–µ—Ç (–±–µ–∑ —Ç–∏–Ω—Ç–∞)
                rotation: (Math.random() - 0.5) * 0.5,
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤–ª–∏—è–Ω–∏–µ —Ç—É–º–∞–Ω–∞ –Ω–∞ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª, –ø–æ–∫–∞ –Ω–µ –Ω–∞—á–Ω–µ–º –ø–æ–ª–µ—Ç
                fog: false
            });

            const sprite = new THREE.Sprite(material);
            const pos = new THREE.Vector3(x * scaleFactor, y * scaleFactor, z * scaleFactor);
            sprite.position.copy(pos);
            sprite.scale.set(0, 0, 0);

            heartGroup.add(sprite);

            particles.push({
                sprite: sprite,
                tunnelShapeX: x * 4,
                tunnelShapeY: y * 4,
                originalZ: z,
                phase: Math.random() * Math.PI * 2
            });

            gsap.to(sprite.scale, {
                x: 1.5, y: 1.5,
                duration: 1.5,
                delay: i * 0.001,
                ease: "back.out(1.7)"
            });
        }

        heartGroup.position.y = isMobile ? 5 : 0;

        // --- 4. –ê–ù–ò–ú–ê–¶–ò–Ø ---
        let isTunnelMode = false;
        let tunnelSpeed = 0;
        let mouseX = 0, mouseY = 0;

        function onMove(e) {
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;
            mouseX = (x - window.innerWidth / 2) / 300;
            mouseY = (y - window.innerHeight / 2) / 300;
        }
        window.addEventListener('mousemove', onMove);
        window.addEventListener('touchmove', onMove, { passive: false });

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;

            if (!isTunnelMode) {
                // –í—Ä–∞—â–µ–Ω–∏–µ
                heartGroup.rotation.y += (mouseX - heartGroup.rotation.y) * 0.05;
                heartGroup.rotation.x += (mouseY - heartGroup.rotation.x) * 0.05;

                particles.forEach(p => {
                    p.sprite.position.y += Math.sin(time * 2 + p.phase) * 0.02;
                });
            } else {
                if (tunnelSpeed < 1.0) tunnelSpeed += 0.01;

                camera.position.z -= tunnelSpeed;
                heartGroup.rotation.z -= 0.005;

                particles.forEach(p => {
                    if (p.sprite.position.z > camera.position.z + 10) {
                        p.sprite.position.z -= 500;
                    }
                });
            }

            renderer.render(scene, camera);
        }
        animate();

        // --- 5. UI ---
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const ui = document.getElementById('ui');
        const successScreen = document.getElementById('successScreen');

        function moveNoBtn() {
            const margin = 20;
            const maxX = window.innerWidth - noBtn.offsetWidth - margin;
            const maxY = window.innerHeight - noBtn.offsetHeight - margin;
            const x = margin + Math.random() * (maxX - margin * 2);
            const y = margin + Math.random() * (maxY - margin * 2);
            noBtn.style.position = 'fixed';
            noBtn.style.left = x + 'px';
            noBtn.style.top = y + 'px';
            if (navigator.vibrate) navigator.vibrate(50);
        }

        noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); moveNoBtn(); });
        noBtn.addEventListener('mouseover', moveNoBtn);

        yesBtn.addEventListener('click', () => {
            gsap.to(ui, { opacity: 0, duration: 0.5, onComplete: () => ui.style.display = 'none' });
            successScreen.style.display = 'flex';
            setTimeout(() => successScreen.classList.add('visible'), 100);

            isTunnelMode = true;
            document.body.classList.add('tunnel-active');

            // –í–∫–ª—é—á–∞–µ–º —Ç—É–º–∞–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –≥–ª—É–±–∏–Ω—ã –≤ —Ç—É–Ω–Ω–µ–ª–µ
            // –ù–æ –¥–µ–ª–∞–µ–º –µ–≥–æ –∫—Ä–∞—Å–Ω–æ–≤–∞—Ç—ã–º –¥–ª—è "—Ç–µ–ø–ª–∞"
            gsap.to(scene.fog, { density: 0.008, duration: 2 });
            scene.fog.color.setHex(0x2a0505);

            gsap.to(heartGroup.rotation, { x: 0, y: 0, z: 0, duration: 1 });

            particles.forEach((p, i) => {
                // –í–∫–ª—é—á–∞–µ–º –≤–ª–∏—è–Ω–∏–µ —Ç—É–º–∞–Ω–∞ –Ω–∞ —á–∞—Å—Ç–∏—Ü—ã –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Ä–µ–∂–∏–º —Ç—É–Ω–Ω–µ–ª—è
                p.sprite.material.fog = true;
                p.sprite.material.needsUpdate = true;

                const targetZ = camera.position.z - 20 - (i * 1.2);

                gsap.to(p.sprite.position, {
                    x: p.tunnelShapeX,
                    y: p.tunnelShapeY,
                    z: targetZ,
                    duration: 2.5,
                    ease: "power2.inOut"
                });

                gsap.to(p.sprite.scale, { x: 3, y: 3, duration: 2 });
                // –í —Ç—É–Ω–Ω–µ–ª–µ –¥–µ–ª–∞–µ–º –∏—Ö —á—É—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã –Ω–∞–ª–æ–∂–µ–Ω–∏–π
                gsap.to(p.sprite.material, { opacity: 0.8, duration: 2 });
            });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            const isMobileNow = window.innerWidth < 768;
            camera.position.z = isMobileNow ? 60 : 40;
        });

    </script>
</body>

</html>
